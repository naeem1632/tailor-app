  <!DOCTYPE html>
  <html xmlns:th="http://www.thymeleaf.org">

    <head>
      <title>Clients - Stitch & Style</title>
      <meta charset="UTF-8"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <link rel="stylesheet" th:href="@{/css/styles.css}">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    </head>


</head>
<body>

<header class="site-header">
  <div class="logo-container">
    <!-- If you later have an image, use this: <img src="/images/logo.png" alt="Stitch & Style Logo" class="logo-img"> -->
    <span class="logo-text">Stitch & Style</span>
  </div>
</header>

<!-- Flash Messages -->
<div th:if="${message}" id="flashMessage" class="alert alert-success">
  <span th:text="${message}"></span>
</div>
<div th:if="${error}" id="flashError" class="alert alert-danger">
  <span th:text="${error}"></span>
</div>

<div class="client-header">
  <h1 th:text="${client.name} + ' (' + ${client.id} + ')' "></h1>
  <img th:if="${client.pictureFilename}" th:src="@{${client.pictureFilename}}" alt="Client Photo" class="client-photo">
</div>


<!-- Action Buttons -->
<div class="actions">
  <button type="button" th:if="${#lists.isEmpty(dressMeasurements)}" onclick="toggleForm('measurementForm')">Add Dress Measurement</button>
  <button type="button" th:if="${#lists.isEmpty(waistcoatMeasurements)}" onclick="toggleForm('waistcoatForm')">Add Waistcoat Measurement</button>
</div>

<!-- ===================== DRESS LIST (Accordion + Edit/Delete) ===================== -->

<table>
  <!-- ===== TABLE HEADER ===== -->
  <thead>
  <tr class="section-title">
    <th colspan="3">
      Dress
      <img src="/images/dress_icon.png" alt="Dress Icon">
    </th>
  </tr>
  <tr class="sub-header">
    <th>Date</th>
    <th>Measurements</th>
    <th>Actions</th>
  </tr>
  </thead>

  <!-- ===== TABLE BODY ===== -->
  <tbody>
  <th:block th:each="m, iter : ${dressMeasurements}">
    <!-- MAIN ROW -->
    <tr>
      <!-- Date -->
      <td th:text="${#temporals.format(m.date, 'dd-MMM-yyyy')}" style="font-weight:600;"></td>

      <!-- Accordion Buttons -->
      <td>
        <div class="accordion-tabs">
          <button class="accordion-btn" data-target="kameez">Kameez</button>
          <button class="accordion-btn" data-target="shalwar">Shalwar</button>
          <button class="accordion-btn" data-target="design">Design & Finishing</button>
          <button class="accordion-btn" data-target="quantity">Quantity</button>
        </div>
      </td>

      <!-- Actions (only latest record) -->
      <td th:if="${iter.index == 0}">
        <a th:href="@{'/print/dress/' + ${client.id}}" target="_blank">Print</a> |
        <a th:href="@{/clients/view/{id}(id=${client.id}, edit=${m.id})}" style="color:#0d6efd; font-weight:600;">Edit</a> |
        <a th:href="@{/clients/deleteMeasurement/{mid}(mid=${m.id})}" style="color:#dc3545; font-weight:600;">Delete</a> |
        <a th:href="@{/clients/copyMeasurement/{mid}(mid=${m.id})}" style="color:#28a745; font-weight:600;">Add new</a>
      </td>

      <!-- Empty for older records -->
      <td th:if="${iter.index != 0}"></td>
    </tr>

    <!-- ACCORDION SUB-ROW -->
    <tr class="accordion-row">
      <td colspan="3" class="accordion-cell">
        <div class="accordion-content-group">

          <!-- KAMEEZ TAB -->
          <div class="accordion-content kameez">
            <table>
              <tr><th>Length</th><td th:text="${m.kameezLength}"></td></tr>
              <tr><th>Arm</th><td th:text="${m.arm}"></td></tr>
              <tr><th>Shoulder-arm</th><td th:text="${m.shoulderArm}"></td></tr>
              <tr><th>Upper Arm</th><td th:text="${m.upperArm}"></td></tr>
              <tr><th>Center Arm</th><td th:text="${m.centerArm}"></td></tr>
              <tr><th>Lower Arm</th><td th:text="${m.lowerArm}"></td></tr>
              <tr><th>Cuff Length</th><td th:text="${m.cuffLength}"></td></tr>
              <tr><th>Cuff Width</th><td th:text="${m.cuffWidth}"></td></tr>
              <tr><th>Terra</th><td th:text="${m.terra}"></td></tr>
              <tr><th>Terra Down</th><td th:text="${m.terraDown}"></td></tr>
              <tr><th>Collar Size</th><td th:text="${m.collarSize}"></td></tr>
              <tr><th>Bain Size</th><td th:text="${m.bainSize}"></td></tr>
              <tr><th>Chest</th><td th:text="${m.chest}"></td></tr>
              <tr><th>Chest Fitting</th><td th:text="${m.chestFitting}"></td></tr>
              <tr><th>Waist</th><td th:text="${m.waist}"></td></tr>
              <tr><th>Hip</th><td th:text="${m.hip}"></td></tr>
            </table>
          </div>

          <!-- SHALWAR TAB -->
          <div class="accordion-content shalwar">
            <table>
              <tr><th>Length</th><td th:text="${m.shalwarLength}"></td></tr>
              <tr><th>Fitting</th><td th:text="${m.shalwarFitting}"></td></tr>
              <tr><th>Asan</th><td th:text="${m.asan}"></td></tr>
              <tr><th>Payncha</th><td th:text="${m.payncha}"></td></tr>
            </table>
          </div>

          <!-- DESIGN TAB -->
          <div class="accordion-content design">
            <table>
              <tr><th>Collar Design</th><td th:text="${m.collarType}"></td></tr>
              <tr>
                <th>Bain Design</th>
                <td>
                  <img th:if="${m.bainType == 'Round-Bain'}" src="/images/bain_round.png" width="30" title="Round"/>
                  <img th:if="${m.bainType == 'Square-Bain'}" src="/images/bain_square.png" width="30" title="Square"/>
                  <img th:if="${m.bainType == 'Cut-Bain'}" src="/images/bain_cut.png" width="30" title="Cut"/>
                </td>
              </tr>
              <tr><th>Daman Type</th><td th:text="${m.damanType}"></td></tr>
              <tr><th>Daman Stitching</th><td th:text="${m.damanStitching}"></td></tr>
              <tr><th>Side Pocket</th><td th:text="${m.sidePocket}"></td></tr>
              <tr><th>Front Pocket</th><td th:text="${m.frontPocket} ? 'Yes' : 'No'"></td></tr>
              <tr>
                <th>Front Pocket Design</th>
                <td>
                  <!-- support both 'Round' and legacy 'Plain' values -->
                  <img th:if="${m.frontPocketType == 'Round' or m.frontPocketType == 'Plain'}" src="/images/pocket_round.png" width="30" title="Round/Plain"/>
                  <img th:if="${m.frontPocketType == 'Cut'}" src="/images/pocket_cut.png" width="30" title="Cut"/>
                  <img th:if="${m.frontPocketType == 'Square'}" src="/images/pocket_square.png" width="30" title="Square"/>
                </td>
              </tr>
              <tr><th>Cuff Type</th><td th:text="${m.cuffType}"></td></tr>
              <tr>
                <th>Cuff Design</th>
                <td>
                  <img th:if="${m.cuffDesign == 'Round-Cuff'}" src="/images/cuff_round.png" width="30" title="Round"/>
                  <img th:if="${m.cuffDesign == 'Square-Cuff'}" src="/images/cuff_square.png" width="30" title="Square"/>
                  <img th:if="${m.cuffDesign == 'Cut-Cuff'}" src="/images/cuff_cut.png" width="30" title="Cut"/>
                </td>
              </tr>
              <tr><th>Jali</th><td th:text="${m.jali}"></td></tr>
              <tr><th>Kanta</th><td th:text="${m.kanta} ? 'Yes' : 'No'"></td></tr>
              <tr><th>Shalwar Pocket</th><td th:text="${m.shalwarPocket} ? 'Yes' : 'No'"></td></tr>
              <tr><th>Stitch Type</th><td th:text="${m.stitchType}"></td></tr>
              <tr><th>Design Stitch</th><td th:text="${m.designStitch} ? 'Yes' : 'No'"></td></tr>
              <tr><th>Button Type</th><td th:text="${m.buttonType}"></td></tr>
              <tr><th>Front Patti Kaj</th><td th:text="${m.frontPattiKaj}"></td></tr>
              <tr><th>Front Patti Design</th><td th:text="${m.frontPattiType}"></td></tr>
              <tr><th>Note</th><td th:text="${m.notes}"></td></tr>
            </table>
          </div>

          <div class="accordion-content quantity">
            <table>
              <tr><th>Dress quantity</th><td th:text="${m.DressQty}"></td></tr>
              <tr><th>With collar</th><td th:text="${m.withCollar}"></td></tr>
              <tr><th>With bain</th><td th:text="${m.withBain}"></td></tr>
              <tr><th>With design</th><td th:text="${m.withDesign}"></td></tr>
            </table>
          </div>

        </div>
      </td>
    </tr>
  </th:block>
  </tbody>
</table>


<!-- ===================== DRESS FORM ===================== -->
<form id="measurementForm"
      class="measure-form"
      th:action="@{${formAction}}"
      method="post"
      th:object="${dressMeasurement}"
      th:attr="data-open=${dressMeasurement.id} != null ? 'true' : 'false'"
      th:style="${dressMeasurement.id} != null ? 'display:block;' : 'display:none;'">

  <input type="hidden" th:field="*{id}"/>

  <div class="grid-8">
    <!-- Section: Kameez -->
    <div class="section-title">Kameez Measurements</div>

    <div><label>Length:</label><input type="text" th:field="*{kameezLength}" required/></div>
    <div><label>Arm:</label><input type="text" th:field="*{arm}" required/></div>
    <div><label>Shoulder-arm:</label><input type="text" th:field="*{shoulderArm}" required/></div>
    <div><label>Upper Arm:</label><input type="text" th:field="*{upperArm}"/></div>
    <div><label>Center Arm:</label><input type="text" th:field="*{centerArm}" required/></div>
    <div><label>Lower Arm:</label><input type="text" th:field="*{lowerArm}"/></div>
    <div><label>Cuff Length:</label><input type="text" th:field="*{cuffLength}"/></div>
    <div><label>Cuff Width:</label><input type="text" th:field="*{cuffWidth}"/></div>
    <div><label>Terra:</label><input type="text" th:field="*{terra}" required/></div>
    <div><label>Terra Down:</label><input type="text" th:field="*{terraDown}"/></div>
    <div><label>Collar Size:</label><input type="text" th:field="*{collarSize}"/></div>
    <div><label>Bain Size:</label><input type="text" th:field="*{bainSize}" required/></div>
    <div><label>Chest:</label><input type="text" th:field="*{chest}" required/></div>
    <div><label>Chest Fitting:</label><input type="text" th:field="*{chestFitting}"/></div>
    <div><label>Waist:</label><input type="text" th:field="*{waist}" required/></div>
    <div><label>Hip:</label><input type="text" th:field="*{hip}" required/></div>

    <!-- Section: Shalwar -->
    <div class="section-title">Shalwar Measurements</div>
    <div><label>Length:</label><input type="text" th:field="*{shalwarLength}" required/></div>
    <div><label>Fitting:</label><input type="text" th:field="*{shalwarFitting}" required/></div>
    <div><label>Asan:</label><input type="text" th:field="*{asan}" required/></div>
    <div><label>Payncha:</label><input type="text" th:field="*{payncha}" required/></div>

    <!-- Section: Design & Finishing -->
    <div class="section-title">Design &amp; Finishing</div>

    <div>
      <label>Daman Type:</label>
      <select th:field="*{damanType}">
        <option value="Square">Square</option>
        <option value="Round">Round</option>
      </select>
    </div>

    <div>
      <label>Daman Stitching:</label>
      <select th:field="*{damanStitching}">
        <option value="Single">Single</option>
        <option value="Double">Double</option>
      </select>
    </div>

    <div>
      <label>Side Pocket:</label>
      <select th:field="*{sidePocket}">
        <option value="No">No</option>
        <option value="1">1</option>
        <option value="2">2</option>
      </select>
    </div>

    <div>
      <label>Cuff Type:</label>
      <select th:field="*{cuffType}">
        <option value="single">Single</option>
        <option value="Double">Double</option>
        <option value="Open">Open</option>
      </select>
    </div>

    <div>
      <label>Stitch Type:</label>
      <select th:field="*{stitchType}">
        <option value="Single">Single</option>
        <option value="Double">Double</option>
        <option value="Simple">Simple</option>
      </select>
    </div>

    <div>
      <label>Button Type:</label>
      <select th:field="*{buttonType}">
        <option value="Plan">Plan</option>
        <option value="Metal">Metal</option>
        <option value="Tich">Tich</option>
      </select>
    </div>

    <div>
      <label>Front Patti design:</label>
      <select th:field="*{frontPattiType}">
        <option value="Round">Round</option>
        <option value="Square">Square</option>
        <option value="Nock">Nock</option>
      </select>
    </div>

    <div>
      <label>Front Patti Kaj:</label>
      <select th:field="*{frontPattiKaj}">
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </div>

    <div>
      <label>Collar design:</label>
      <select th:field="*{collarType}">
        <option value="No">No</option>
        <option value="1">1</option><option value="2">2</option>
        <option value="3">3</option><option value="4">4</option>
        <option value="5">5</option><option value="6">6</option>
        <option value="7">7</option><option value="8">8</option>
        <option value="9">9</option><option value="10">10</option>
      </select>
    </div>

    <div class="options-row">
      <label>Bain Design:</label>
      <div class="options-inline">
        <label><input type="radio" th:field="*{bainType}" value="Round-Bain"/><img src="/images/bain_round.png" alt="Round"/> Round</label>
        <label><input type="radio" th:field="*{bainType}" value="Square-Bain"/><img src="/images/bain_square.png" alt="Square"/> Square</label>
        <label><input type="radio" th:field="*{bainType}" value="Cut-Bain"/><img src="/images/bain_cut.png" alt="Cut"/> Cut</label>
      </div>
    </div>

    <div class="options-row">
      <label>Cuff Design:</label>
      <div class="options-inline">
        <label><input type="radio" th:field="*{cuffDesign}" value="Round-Cuff"/><img src="/images/cuff_round.png" alt="Round"/> Round</label>
        <label><input type="radio" th:field="*{cuffDesign}" value="Square-Cuff"/><img src="/images/cuff_square.png" alt="Square"/> Square</label>
        <label><input type="radio" th:field="*{cuffDesign}" value="Cut-Cuff"/><img src="/images/cuff_cut.png" alt="Cut"/> Cut</label>
      </div>
    </div>

    <div>
      <label>Front Pocket:</label>
      <input type="checkbox" id="frontPocketCheckbox" th:field="*{frontPocket}"/>
    </div>

    <div class="options-row" id="frontPocketDesign">
      <label>Pocket Design:</label>
      <div class="options-inline">
        <label><input type="radio" th:field="*{frontPocketType}" value="Round"/>
          <img src="/images/pocket_round.png" alt="Round"/> Round
        </label>
        <label><input type="radio" th:field="*{frontPocketType}" value="Cut"/>
          <img src="/images/pocket_cut.png" alt="Cut"/> Cut
        </label>
        <label><input type="radio" th:field="*{frontPocketType}" value="Square"/>
          <img src="/images/pocket_square.png" alt="Square"/> Square
        </label>
      </div>
    </div>

    <div>
      <label>Jali:</label>
      <select th:field="*{jali}">
        <option value="No">No</option>
        <option value="1">1</option>
        <option value="2">2</option>
      </select>
    </div>

    <div><label>Kanta:</label><input type="checkbox" th:field="*{kanta}"/></div>
    <div><label>Shalwar Pocket:</label><input type="checkbox" th:field="*{shalwarPocket}"/></div>
    <div><label>Design Stitch:</label><input type="checkbox" th:field="*{designStitch}"/></div>

    <!-- Section: quantity -->
    <div class="section-title">Dress quantity</div>
    <div>
      <label>Dress quantity:</label>
      <select th:field="*{DressQty}">
        <option value=0>0</option>
        <option value=1>1</option><option value=2>2</option>
        <option value=3>3</option><option value=4>4</option>
        <option value=5>5</option><option value=6>6</option>
        <option value=7>7</option><option value=8>8</option>
        <option value=9>9</option><option value=10>10</option>
      </select>
    </div>

    <div>
      <label>With collar:</label>
      <select th:field="*{withCollar}">
        <option value=0>0</option>
        <option value=1>1</option><option value=2>2</option>
        <option value=3>3</option><option value=4>4</option>
        <option value=5>5</option><option value=6>6</option>
        <option value=7>7</option><option value=8>8</option>
        <option value=9>9</option><option value=10>10</option>
      </select>
    </div>

    <div>
      <label>With bain:</label>
      <select th:field="*{withBain}">
        <option value=0>0</option>
        <option value=1>1</option><option value=2>2</option>
        <option value=3>3</option><option value=4>4</option>
        <option value=5>5</option><option value=6>6</option>
        <option value=7>7</option><option value=8>8</option>
        <option value=9>9</option><option value=10>10</option>
      </select>
    </div>

    <div>
      <label>With design:</label>
      <select th:field="*{withDesign}">
        <option value=0>0</option>
        <option value=1>1</option><option value=2>2</option>
        <option value=3>3</option><option value=4>4</option>
        <option value=5>5</option><option value=6>6</option>
        <option value=7>7</option><option value=8>8</option>
        <option value=9>9</option><option value=10>10</option>
      </select>
    </div>

    <!-- Inline error message area -->
    <div id="quantityError"
         style="grid-column: span 8; color: #dc3545; font-weight:600; display:none; font-size:14px; padding-top:6px;">
    </div>

    <!-- Notes -->
    <div style="grid-column: span 8;">
      <label>Notes:</label>
      <textarea th:field="*{notes}"></textarea>
    </div>
  </div>

  <div class="actions">
    <button type="submit">Save Dress Measurement</button>
    <a th:href="@{/clients/view/{id}(id=${client.id})}"
       style="margin-left:10px; padding:10px 20px; background:#6c757d; color:#fff; border-radius:6px; font-weight:600; text-decoration:none;">
      ✖ Cancel
    </a>
  </div>

</form>

<!-- ===================== WAISTCOAT LIST (Accordion + Edit/Delete) ===================== -->

<table>
  <thead>
  <tr class="section-title">
    <th colspan="3">
      Waistcoat
      <img src="/images/waistcoat_icon.png" alt="Waistcoat Icon">
    </th>
  </tr>
  <tr class="sub-header">
    <th>Date</th>
    <th>Measurements</th>
    <th>Actions</th>
  </tr>
  </thead>

  <tbody>
  <th:block th:each="w, iter : ${waistcoatMeasurements}">
    <!-- MAIN ROW -->
    <tr>
      <td th:text="${#temporals.format(w.date, 'dd-MMM-yyyy')}" style="font-weight:600;"></td>

      <td>
        <div class="accordion-tabs">
          <button class="accordion-btn" data-target="measurements">Waistcoat</button>
          <button class="accordion-btn" data-target="quantity">Quantity</button>
        </div>
      </td>

      <td th:if="${iter.index == 0}">
        <a th:href="@{'/print/waistcoat/' + ${client.id}}" target="_blank">Print</a> |
        <a th:href="@{/clients/view/{id}(id=${client.id}, editWaistcoat=${w.id})}" style="color:#0d6efd; font-weight:600;">Edit</a> |
        <a th:href="@{/clients/deleteWaistcoatMeasurement/{id}(id=${w.id})}" style="color:#dc3545; font-weight:600;">Delete</a> |
        <a th:href="@{/clients/copyWaistcoatMeasurement/{mid}(mid=${w.id})}" style="color:#28a745; font-weight:600;">Add new</a>
      </td>

      <td th:if="${iter.index != 0}"></td>
    </tr>

    <!-- ACCORDION SUB-ROW -->
    <tr class="accordion-row">
      <td colspan="3" class="accordion-cell">
        <div class="accordion-content-group">

          <!-- Measurements -->
          <div class="accordion-content measurements">
            <table>
              <tr><th>Length</th><td th:text="${w.length}"></td></tr>
              <tr><th>Shoulder</th><td th:text="${w.shoulder}"></td></tr>
              <tr><th>Neck</th><td th:text="${w.neck}"></td></tr>
              <tr><th>Chest</th><td th:text="${w.chest}"></td></tr>
              <tr><th>Chest Fitting</th><td th:text="${w.chestFitting}"></td></tr>
              <tr><th>Hip</th><td th:text="${w.hip}"></td></tr>
              <tr><th>Bain Width</th><td th:text="${w.bainSize}"></td></tr>
              <tr><th>Bain Style</th><td th:text="${w.bainType}"></td></tr>
              <tr><th>Daman Style</th><td th:text="${w.damanType}"></td></tr>
              <tr><th>Notes</th><td th:text="${w.notes}"></td></tr>
            </table>
          </div>

          <div class="accordion-content quantity">
            <table>
              <tr><th>Waistcoat quantity</th><td th:text="${w.qty}"></td></tr>
            </table>
          </div>

        </div>
      </td>
    </tr>
  </th:block>
  </tbody>
</table>

<!-- ===================== WAISTCOAT FORM ===================== -->
<form id="waistcoatForm"
      class="measure-form"
      th:action="@{${waistcoatFormAction}}"
      method="post"
      th:object="${waistcoatMeasurement}"
      th:attr="data-open=${waistcoatMeasurement.id} != null ? 'true' : 'false'"
      th:style="${waistcoatMeasurement.id} != null ? 'display:block;' : 'display:none;'">

  <input type="hidden" th:field="*{id}"/>
  <input type="hidden" th:field="*{client.id}"/>

  <div class="grid-8">
    <div class="section-title">Waistcoat Measurements</div>

    <div><label>Length:</label><input type="text" th:field="*{length}" required/></div>
    <div><label>Shoulder:</label><input type="text" th:field="*{shoulder}" required/></div>
    <div><label>Neck:</label><input type="text" th:field="*{neck}" required/></div>
    <div><label>Chest:</label><input type="text" th:field="*{chest}" required/></div>
    <div><label>Chest Fitting:</label><input type="text" th:field="*{chestFitting}" required/></div>
    <div><label>Hip:</label><input type="text" th:field="*{hip}" required/></div>
    <div><label>Bain Width:</label><input type="text" th:field="*{bainSize}" required/></div>

    <div>
      <label>Bain Style:</label>
      <select th:field="*{bainType}">
        <option value="Round">Round</option>
        <option value="V shape">V shape</option>
      </select>
    </div>

    <div>
      <label>Daman Style:</label>
      <select th:field="*{damanType}">
        <option value="Round">Round</option>
        <option value="Square">Square</option>
      </select>
    </div>

    <div style="grid-column: span 8;">
      <label>Notes:</label>
      <textarea th:field="*{notes}"></textarea>
    </div>
  </div>

  <!-- Section: quantity -->
  <div class="section-title">Dress quantity</div>
  <div>
    <label>Waistcoat quantity:</label>
    <select th:field="*{qty}">
      <option value=0>0</option>
      <option value=1>1</option><option value=2>2</option>
      <option value=3>3</option><option value=4>4</option>
      <option value=5>5</option><option value=6>6</option>
      <option value=7>7</option><option value=8>8</option>
      <option value=9>9</option><option value=10>10</option>
    </select>
  </div>

  <div class="actions">
    <button type="submit">Save Waistcoat Measurement</button>
    <a th:href="@{/clients/view/{id}(id=${client.id})}"
       style="margin-left:10px; padding:10px 20px; background:#6c757d; color:#fff; border-radius:6px; font-weight:600; text-decoration:none;">
      ✖ Cancel
    </a>
  </div>
</form>

<!-- ✅ Go Back Button -->
<div class="go-back-container">
  <a th:href="@{/clients}" class="go-back-btn">Go Back Home</a>
</div>

<!-- ✅ Custom Delete Confirmation Modal -->
<div id="confirmDeleteModal" class="modal-overlay">
  <div class="modal-box">
    <h3>⚠ Confirm Deletion</h3>
    <p>Are you sure you want to delete this record?</p>
    <div class="modal-actions">
      <button id="confirmDeleteBtn" class="btn-danger">Yes, Delete</button>
      <button id="cancelDeleteBtn" class="btn-secondary">Cancel</button>
    </div>
  </div>
</div>

<script>
  function toggleForm(formId) {
    document.querySelectorAll("form.measure-form").forEach(f => f.style.display = "none");
    const form = document.getElementById(formId);
    if (form) {
      form.style.display = "block";
      window.scrollTo({ top: form.offsetTop - 10, behavior: 'smooth' });
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    /* ================= ACCORDION TOGGLE (for both Dress + Waistcoat) ================= */
    document.querySelectorAll("tbody tr").forEach(row => {
      const nextRow = row.nextElementSibling;
      if (!nextRow || !nextRow.classList.contains("accordion-row")) return;

      const buttons = row.querySelectorAll(".accordion-btn");
      const contents = nextRow.querySelectorAll(".accordion-content");

      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-target");
          const targetContent = nextRow.querySelector(`.${target}`);
          const isVisible = targetContent.classList.contains("show");

          // reset within this row group
          buttons.forEach(b => b.classList.remove("active"));
          contents.forEach(c => c.classList.remove("show"));
          nextRow.classList.remove("show");

          if (!isVisible) {
            btn.classList.add("active");
            targetContent.classList.add("show");
            nextRow.classList.add("show");
          }
        });
      });
    });

    /* ================= AUTO-HIDE FLASH MESSAGES ================= */
    const flashMsg = document.getElementById("flashMessage");
    if (flashMsg) {
      setTimeout(() => {
        flashMsg.style.transition = "opacity 0.8s";
        flashMsg.style.opacity = "0";
        setTimeout(() => flashMsg.remove(), 800);
      }, 3000);
    }

    const flashErr = document.getElementById("flashError");
    if (flashErr) {
      setTimeout(() => {
        flashErr.style.transition = "opacity 0.8s";
        flashErr.style.opacity = "0";
        setTimeout(() => flashErr.remove(), 800);
      }, 4000);
    }

    /* ================= KEEP FORM OPEN WHEN EDITING ================= */
    const dressForm = document.getElementById("measurementForm");
    const waistForm = document.getElementById("waistcoatForm");
    if (dressForm && dressForm.getAttribute("data-open") === "true") {
      dressForm.style.display = "block";
    }
    if (waistForm && waistForm.getAttribute("data-open") === "true") {
      waistForm.style.display = "block";
    }
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const checkbox = document.getElementById("frontPocketCheckbox");
    const pocketDesign = document.getElementById("frontPocketDesign");

    // Initial visibility
    pocketDesign.style.display = checkbox.checked ? "flex" : "none";

    // Toggle on change
    checkbox.addEventListener("change", () => {
      pocketDesign.style.display = checkbox.checked ? "flex" : "none";
    });
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const dressQty = document.querySelector("[name='DressQty']");
    const withCollar = document.querySelector("[name='withCollar']");
    const withBain = document.querySelector("[name='withBain']");
    const withDesign = document.querySelector("[name='withDesign']");
    const form = document.getElementById("measurementForm");
    const errorDiv = document.getElementById("quantityError");

    function validateQuantities() {
      const qty = parseInt(dressQty.value || 0);
      const collar = parseInt(withCollar.value || 0);
      const bain = parseInt(withBain.value || 0);
      const design = parseInt(withDesign.value || 0);

      let invalid = false;
      let message = "";

      if (collar > qty || bain > qty || design > qty || collar + bain > qty) {
        invalid = true;
        message = "❌ Invalid quantities: 'With Collar', 'With Bain', or 'With Design' (individually or combined) cannot exceed the total Dress Quantity.";
      }

      if (invalid) {
        errorDiv.textContent = message;
        errorDiv.style.display = "block";
        return false;
      } else {
        errorDiv.style.display = "none";
        errorDiv.textContent = "";
        return true;
      }
    }

    // Validate on submit
    form.addEventListener("submit", function (e) {
      if (!validateQuantities()) {
        e.preventDefault();
        // Scroll to error for better UX
        errorDiv.scrollIntoView({ behavior: "smooth", block: "center" });
      }
    });

    // Live validation
    [dressQty, withCollar, withBain, withDesign].forEach(el => {
      el.addEventListener("change", validateQuantities);
    });
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const numericFields = document.querySelectorAll(
      "#measurementForm input[type='text'], #waistcoatForm input[type='text']"
    );

    // Common numeric field names
    const numericKeywords = [
      "length", "arm", "shoulder", "upperarm", "centerarm", "lowerarm",
      "terra", "terradown", "collarsize", "bainsize", "chest", "chestfitting",
      "waist", "hip", "asan", "payncha", "fitting", "neck", "cuffwidth"
    ];

    // Create an error span for each input
    numericFields.forEach(input => {
      if (!input.nextElementSibling || !input.nextElementSibling.classList.contains("error-msg")) {
        const span = document.createElement("span");
        span.className = "error-msg";
        span.style.color = "#dc3545";
        span.style.fontSize = "13px";
        span.style.display = "none";
        input.insertAdjacentElement("afterend", span);
      }
    });

    function isNumeric(value) {
      return value === "" || /^-?\d*\.?\d*$/.test(value);
    }

    function isNumberField(name) {
      if (!name) return false;
      return numericKeywords.some(k => name.toLowerCase().includes(k));
    }

    function validateInput(input) {
      const name = input.getAttribute("name");
      const errorMsg = input.nextElementSibling;

      // Skip non-numeric fields
      if (!isNumberField(name)) return true;

      if (!isNumeric(input.value)) {
        errorMsg.textContent = "Please enter a valid number.";
        errorMsg.style.display = "block";
        input.classList.add("invalid");
        return false;
      } else {
        errorMsg.style.display = "none";
        input.classList.remove("invalid");
        return true;
      }
    }

    // Live validation as user types
    numericFields.forEach(input => {
      input.addEventListener("input", () => validateInput(input));
      input.addEventListener("blur", () => validateInput(input));
    });

    function validateForm(formId) {
      let valid = true;
      const inputs = document.querySelectorAll(`#${formId} input[type='text']`);
      inputs.forEach(input => {
        if (!validateInput(input)) valid = false;
      });
      return valid;
    }

    // Attach submit listeners to forms
    ["measurementForm", "waistcoatForm"].forEach(formId => {
      const form = document.getElementById(formId);
      if (!form) return;

      form.addEventListener("submit", e => {
        const valid = validateForm(formId);
        if (!valid) {
          e.preventDefault(); // ✅ Stop form from submitting
          const firstError = form.querySelector(".invalid");
          if (firstError) firstError.scrollIntoView({ behavior: "smooth", block: "center" });
        }
      });
    });
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let deleteUrl = null;
    const modal = document.getElementById("confirmDeleteModal");
    const confirmBtn = document.getElementById("confirmDeleteBtn");
    const cancelBtn = document.getElementById("cancelDeleteBtn");

    // Intercept all delete links
    document.querySelectorAll("a[href*='/deleteMeasurement/'], a[href*='/deleteWaistcoatMeasurement/']").forEach(link => {
      link.addEventListener("click", function (e) {
        e.preventDefault(); // stop immediate navigation
        deleteUrl = this.getAttribute("href");
        modal.style.display = "flex"; // show modal
      });
    });

    confirmBtn.addEventListener("click", function () {
      if (deleteUrl) {
        window.location.href = deleteUrl; // redirect to delete endpoint
      }
    });

    cancelBtn.addEventListener("click", function () {
      modal.style.display = "none";
      deleteUrl = null;
    });

    // Close modal when clicking outside box
    modal.addEventListener("click", function (e) {
      if (e.target === modal) {
        modal.style.display = "none";
        deleteUrl = null;
      }
    });
  });
</script>



</body>
</html>
